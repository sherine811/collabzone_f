<!doctype html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Admin Panel</title><link rel="stylesheet" href="assets/css/style.css"></head>
<body>
<div class="container">
  <div class="header"><div class="logo card"><img src="assets/img/logo.gif" alt="logo" onerror="this.src='https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif'"></div><div><h2>Admin</h2><div class="small">Create events & view feedback</div></div></div>

  <div class="card" style="margin-top:12px">
    <h3>Create Event</h3>
    <input id="a_title" placeholder="Title">
    <input id="a_date" placeholder="Date (YYYY-MM-DD)">
    <input id="a_desc" placeholder="Short description">
    <div style="display:flex;gap:8px"><button class="btn" id="a_create">Create</button><button class="feedback-btn" id="a_refresh">Refresh List</button></div>
  </div>

  <div class="card" style="margin-top:12px">
    <h3>Events</h3>
    <div id="events_list"></div>
  </div>

  <div class="card" style="margin-top:12px">
    <h3>Feedback</h3>
    <div id="fb_list"></div>
  </div>
</div>
<script src="assets/js/app.js"></script>
<script>
  const sess = JSON.parse(localStorage.getItem('cp_session')||'null');
  if(!sess||sess.role!=='admin') { alert('Please login as admin'); location.href='index.html'; }
  function refresh(){
    const events = CP.get('cp_events');
    document.getElementById('events_list').innerHTML = events.map(e=>`<div class="event"><strong>${e.title}</strong> <div class="small">${e.date}</div><div class="small">${e.desc}</div><div style="margin-top:6px"><button class="feedback-btn" onclick="del('${e.id}')">Delete</button></div></div>`).join('');
    const fbs = CP.get('cp_feedback');
    document.getElementById('fb_list').innerHTML = (fbs.length? fbs.map(f=>`<div class="event"><div class="small">event: ${ (CP.get('cp_events').find(e=>e.id===f.eventId)||{}).title || f.eventId }</div><div>${f.text}</div></div>`).join('') : '<div class="small">No feedback yet</div>');
  }
  document.getElementById('a_create').addEventListener('click', ()=>{
    const ev={id:Math.random().toString(36).slice(2),title:document.getElementById('a_title').value,date:document.getElementById('a_date').value,desc:document.getElementById('a_desc').value};
    if(!ev.title) return alert('title required');
    CP.createEvent(ev); refresh();
  });
  function del(id){ if(confirm('Delete event?')){ CP.deleteEvent(id); refresh(); }}
  window.del = del; document.getElementById('a_refresh').addEventListener('click', refresh);
  refresh();
</script>
</body>
</html>
